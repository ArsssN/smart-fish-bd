<?php

if (!function_exists('getOxygenSensorUpdate')) {
    function getOxygenSensorUpdate($value): array|string
    {
        $sensorList = array();

        if ($value <= 3)
            $sensorList = [1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0];
        else if ($value <= 4.5)
            $sensorList = [0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0];
        else if ($value <= 6)
            $sensorList = [1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0];
        else if ($value < 7)
            $sensorList = [0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0];
        else $sensorList = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        /*else
            return "Invalid DO level. Please enter a value between 0 and 8.";*/

        return $sensorList;
    }
}

if (!function_exists('convertDOValue')) {
    function convertDOValue($doValue, $currentTime = null)
    {
        // if no $currentTime is provided, use the current time
        if ($currentTime === null) {
            $currentTime = date('H:i');
        }

        // Define the conversion values based on time ranges
        $conversionValues = [
            '05:00-05:20' => 2.80,
            '05:21-05:41' => 2.81,
            '05:42-06:02' => 2.82,
            '06:03-06:23' => 2.85,
            '06:24-06:44' => 3.18,
            '06:45-07:05' => 3.48,
            '07:06-07:26' => 3.76,
            '07:27-07:47' => 4.23,
            '07:48-08:08' => 4.64,
            '08:09-08:29' => 4.97,
            '08:30-08:50' => 5.32,
            '08:51-09:11' => 5.61,
            '09:12-09:32' => 5.42,
            '09:33-09:53' => 5.11,
            '09:54-10:14' => 4.85,
            '10:15-10:35' => 4.74,
            '10:36-10:56' => 4.47,
            '10:57-11:17' => 4.39,
            '11:18-11:38' => 4.62,
            '11:39-11:59' => 4.88,
            '12:00-12:20' => 5.19,
            '12:21-12:41' => 5.63,
            '12:42-13:02' => 5.92,
            '13:03-13:23' => 7.01,
            '13:24-13:44' => 6.82,
            '13:45-14:05' => 6.49,
            '14:06-14:26' => 6.23,
            '14:27-14:47' => 5.93,
            '14:48-15:08' => 5.61,
            '15:09-15:29' => 5.14,
            '15:30-15:50' => 4.51,
            '15:51-16:11' => 4.06,
            '16:12-16:32' => 3.36,
            '16:33-16:53' => 2.99,
            '16:54-17:14' => 3.17,
            '17:15-17:35' => 3.53,
            '17:36-17:56' => 2.91,
            '17:57-18:17' => 2.85,
            '18:18-18:38' => 2.93,
            '18:39-18:59' => 3.05,
            '19:00-19:20' => 3.24,
            '19:21-19:41' => 3.32,
            '19:42-20:02' => 3.56,
            '20:03-20:23' => 3.61,
            '20:24-20:44' => 3.77,
            '20:45-21:05' => 3.86,
            '21:06-21:26' => 4.05,
            '21:27-21:47' => 4.21,
            '21:48-22:08' => 4.57,
            '22:09-22:29' => 4.64,
            '22:30-22:50' => 4.83,
            '22:51-23:11' => 5.01,
            '23:12-23:32' => 5.19,
            '23:33-23:53' => 5.43,
            '23:54-00:14' => 5.65,
            '00:15-00:35' => 5.82,
            '00:36-00:56' => 6.01,
            '00:57-01:17' => 6.12,
            '01:18-01:38' => 6.21,
            '01:39-01:59' => 6.14,
            '02:00-02:20' => 6.05,
            '02:21-02:41' => 5.83,
            '02:42-03:02' => 5.67,
            '03:03-03:23' => 5.34,
            '03:24-03:44' => 4.91,
            '03:45-04:05' => 4.53,
            '04:06-04:26' => 4.08,
            '04:27-04:47' => 3.65,
            '04:48-04:59' => 3.23,
        ];

        /*$conversionValues = [
            '5:00-6:00' => 4.2,
            '6:00-7:00' => 4.1,
            '7:00-8:00' => 4.4,
            '8:00-9:00' => 5.1,
            '9:00-10:00' => 6.2,
            '10:00-11:00' => 6.8,
            '11:00-12:00' => 6.5,
            '12:00-13:00' => 6.1,
            '13:00-14:00' => 5.5,
            '14:00-15:00' => 5.2,
            '15:00-16:00' => 5.0,
            '16:00-17:00' => 4.8,
            '17:00-18:00' => 4.5,
            '18:00-19:00' => 4.0,
            '19:00-20:00' => 3.5,
            '20:00-21:00' => 2.9,
            '21:00-22:00' => 3.4,
            '22:00-23:00' => 4.6,
            '23:00-24:00' => 4.7,
            '00:00-01:00' => 4.1,
            '01:00-02:00' => 4.6,
            '02:00-03:00' => 6.1,
            '03:00-04:00' => 4.6,
            '04:00-05:00' => 4.3,
        ];*/

        // Extract the hour and minute from currentTime
        $hour = (int)date('H', strtotime($currentTime));
        $minute = (int)date('i', strtotime($currentTime));

        // Determine the time range key
        $timeRange = sprintf('%02d:00-%02d:00', $hour, $hour + 1);

        // Convert DO value based on the time range
        if ($doValue < 1.5) {
            if (array_key_exists($timeRange, $conversionValues)) {
                return $conversionValues[$timeRange];
            } else {
                // If time range not found, return original DO value
                return $doValue;
            }
        }

        // Return the original DO value if not less than 1.5
        return $doValue;
    }
}
